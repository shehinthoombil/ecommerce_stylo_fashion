<body>
    <div class="container-scroller">
        <%- include('../partials/admin/header') %>
            <%- include('../partials/admin/sidePanel') %>


                <!-- partial -->
                <div class="container-fluid page-body-wrapper">
                    <div class="main-panel">
                        <div class="content-wrapper">
                            <div class="row">
                                <div class="col-sm-4 grid-margin">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5>Revenue</h5>
                                            <div class="row">
                                                <div class="col-8 col-sm-12 col-xl-8 my-auto">
                                                    <div class="d-flex d-sm-block d-md-flex align-items-center">
                                                        <h2 class="mb-0">$<%= totalRevenue %>.01</h2>
                                                        <!-- <p class="text-success ml-2 mb-0 font-weight-medium">+3.5%</p> -->
                                                    </div>
                                                </div>
                                                <div class="col-4 col-sm-12 col-xl-4 text-center text-xl-right">
                                                    <!-- <i class="icon-lg mdi mdi-codepen text-primary ml-auto"></i> -->
                                                    <i class="icon-lg mdi mdi-currency-usd text-primary ml-auto"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4 grid-margin">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5>Total Sales</h5>
                                            <div class="row">
                                                <div class="col-8 col-sm-12 col-xl-8 my-auto">
                                                    <div class="d-flex d-sm-block d-md-flex align-items-center">
                                                        <h2 class="mb-0">
                                                            <%= orderCount %>
                                                        </h2>
                                                        <!-- <p class="text-success ml-2 mb-0 font-weight-medium">+8.3%</p> -->
                                                    </div>

                                                </div>
                                                <div class="col-4 col-sm-12 col-xl-4 text-center text-xl-right">
                                                    <!-- <i class="icon-lg mdi mdi-wallet-travel text-danger ml-auto"></i> -->
                                                    <i class="icon-lg mdi mdi-cart text-warning ml-auto"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4 grid-margin">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5>Total Users</h5>
                                            <div class="row">
                                                <div class="col-8 col-sm-12 col-xl-8 my-auto">
                                                    <div class="d-flex d-sm-block d-md-flex align-items-center">
                                                        <h2 class="mb-0">
                                                            <%= userCount %>
                                                        </h2>
                                                        <!-- <p class="text-danger ml-2 mb-0 font-weight-medium">-2.1% </p> -->
                                                    </div>

                                                </div>
                                                <div class="col-4 col-sm-12 col-xl-4 text-center text-xl-right">
                                                    <!-- <i class="icon-lg mdi mdi-monitor text-success ml-auto"></i> -->
                                                    <i class="icon-lg mdi mdi-account text-success ml-auto"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-4 grid-margin stretch-card">
                                    <div class="row">
                                        <div class="card">
                                            <div class="card-body">

                                                <h4 class="card-title">Sales Report</h4>

                                                <canvas id="myChart" class="chart embed-responsive-item"
                                                    style="width: 100%; height: 300px;"></canvas>
                                            </div>
                                            <!-- <div class="d-flex justify-content-mt-3"> -->
                                            <div class="d-flex justify-content-between mt-3">
                                                <h6 class="mb-3">Filter Report :</h6>
                                                <button id="weekly" onclick="filterData('week')"
                                                    class="btn btn-inverse-info ml-0 px-4">Weekly</button>
                                                <button id="monthly" onclick="filterData('month')"
                                                    class="btn btn-inverse-info ml-3 px-4">Monthly</button>
                                                <button id="yearly" onclick="filterData('year')"
                                                    class="btn btn-inverse-info ml-3 px-4">Yearly</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>






                            <div class="row">
                                <div class="col-md-4 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <h4 class="card-title">Transaction History</h4>
                                            <canvas id="transaction-history" class="transaction-chart"></canvas>
                                            <div
                                                class="bg-gray-dark d-flex d-md-block d-xl-flex flex-row py-3 px-4 px-md-3 px-xl-4 rounded mt-3">
                                                <div class="text-md-center text-xl-left">
                                                    <h6 class="mb-1">Transfer to Paypal</h6>
                                                    <p class="text-muted mb-0">07 Jan 2019, 09:12AM</p>
                                                </div>
                                                <div
                                                    class="align-self-center flex-grow text-right text-md-center text-xl-right py-md-2 py-xl-0">
                                                    <h6 class="font-weight-bold mb-0">$236</h6>
                                                </div>
                                            </div>
                                            <div
                                                class="bg-gray-dark d-flex d-md-block d-xl-flex flex-row py-3 px-4 px-md-3 px-xl-4 rounded mt-3">
                                                <div class="text-md-center text-xl-left">
                                                    <h6 class="mb-1">Tranfer to Stripe</h6>
                                                    <p class="text-muted mb-0">07 Jan 2019, 09:12AM</p>
                                                </div>
                                                <div
                                                    class="align-self-center flex-grow text-right text-md-center text-xl-right py-md-2 py-xl-0">
                                                    <h6 class="font-weight-bold mb-0">$593</h6>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 col-xl-4 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="d-flex flex-row justify-content-between">
                                                <h4 class="card-title">Messages</h4>
                                                <p class="text-muted mb-1 small">View all</p>
                                            </div>
                                            <div class="preview-list">
                                                <div class="preview-item border-bottom">
                                                    <div class="preview-thumbnail">
                                                        <img src="/assets/images/faces/face6.jpg" alt="image"
                                                            class="rounded-circle" />
                                                    </div>
                                                    <div class="preview-item-content d-flex flex-grow">
                                                        <div class="flex-grow">
                                                            <div
                                                                class="d-flex d-md-block d-xl-flex justify-content-between">
                                                                <h6 class="preview-subject">Leonard</h6>
                                                                <p class="text-muted text-small">5 minutes ago</p>
                                                            </div>
                                                            <p class="text-muted">Well, it seems to be working now.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="preview-item border-bottom">
                                                    <div class="preview-thumbnail">
                                                        <img src="/assets/images/faces/face8.jpg" alt="image"
                                                            class="rounded-circle" />
                                                    </div>
                                                    <div class="preview-item-content d-flex flex-grow">
                                                        <div class="flex-grow">
                                                            <div
                                                                class="d-flex d-md-block d-xl-flex justify-content-between">
                                                                <h6 class="preview-subject">Luella Mills</h6>
                                                                <p class="text-muted text-small">10 Minutes Ago</p>
                                                            </div>
                                                            <p class="text-muted">Well, it seems to be working now.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="preview-item border-bottom">
                                                    <div class="preview-thumbnail">
                                                        <img src="/assets/images/faces/face9.jpg" alt="image"
                                                            class="rounded-circle" />
                                                    </div>
                                                    <div class="preview-item-content d-flex flex-grow">
                                                        <div class="flex-grow">
                                                            <div
                                                                class="d-flex d-md-block d-xl-flex justify-content-between">
                                                                <h6 class="preview-subject">Ethel Kelly</h6>
                                                                <p class="text-muted text-small">2 Hours Ago</p>
                                                            </div>
                                                            <p class="text-muted">Please review the tickets</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="preview-item border-bottom">
                                                    <div class="preview-thumbnail">
                                                        <img src="/assets/images/faces/face11.jpg" alt="image"
                                                            class="rounded-circle" />
                                                    </div>
                                                    <div class="preview-item-content d-flex flex-grow">
                                                        <div class="flex-grow">
                                                            <div
                                                                class="d-flex d-md-block d-xl-flex justify-content-between">
                                                                <h6 class="preview-subject">Herman May</h6>
                                                                <p class="text-muted text-small">4 Hours Ago</p>
                                                            </div>
                                                            <p class="text-muted">Thanks a lot. It was easy to fix it .
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
                        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                        <script>
                            let COD = '<%= totalCod %>',
                                Online = '<%= totalOnline %>'
                            console.log(COD);
                            console.log(Online);

                            var data = {
                                labels: ['COD', 'Online'],
                                datasets: [{
                                    data: [COD, Online],
                                    backgroundColor: ['#FF6384', '#36A2EB']
                                }]
                            };

                            var ctx = document.getElementById('myChart').getContext('2d');

                            var myPieChart = new Chart(ctx, {
                                type: 'pie',
                                data: data
                            });

                        </script>
                        <script>
                            const filterData = async (range) => {
                                console.log(filterData, 'fiterkk keri');
                                try {
                                    // Update your logic to fetch data based on the selected range
                                    let totalData;

                                    if (range === 'week') {
                                        console.log("hii week");
                                        totalData = await fetchWeekData();
                                    } else if (range === 'month') {
                                        totalData = await fetchMonthData();
                                    } else if (range === 'year') {
                                        totalData = await fetchYearData();
                                    }

                                    // Update the chart with the new data
                                    updateChart(totalData);
                                } catch (error) {
                                    console.log(error.message);
                                }
                            };
                            const updateChart = (totalData) => {
                                var data = {
                                    labels: ['COD', 'Online'],
                                    datasets: [{
                                        data: totalData,
                                        backgroundColor: ['#FF6384', '#36A2EB']
                                    }]
                                };

                                // Get the context of the canvas element
                                var ctx = document.getElementById('myChart').getContext('2d');

                                // Update the pie chart
                                myPieChart.data = data;
                                myPieChart.update();
                            };

                            const fetchWeekData = async () => {
                                const response = await fetch('/admin/chartWeek');
                                const data = await response.json();
                                console.log(data);
                                return data;


                            };
                            const fetchMonthData = async () => {
                                const response = await fetch('/admin/chartMonth');
                                const data = await response.json();
                                console.log(data);
                                return data;
                            };
                            const fetchYearData = async () => {
                                const response = await fetch('/admin/chartYear');
                                const data = await response.json();
                                console.log(data);
                                return data;
                            };

                        </script>





                        <!-- content-wrapper ends -->
                        <!-- partial:partials/_footer.html -->
                        <footer class="footer">
                            <div class="d-sm-flex justify-content-center justify-content-sm-between">
                                <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">Copyright Â©
                                    bootstrapdash.com 2020</span>
                                <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center"> Free <a
                                        href="https://www.bootstrapdash.com/bootstrap-admin-template/"
                                        target="_blank">Bootstrap
                                        admin templates</a> from Bootstrapdash.com</span>
                            </div>
                        </footer>
                        <!-- partial -->
                    </div>
                    <!-- main-panel ends -->
                </div>
                <!-- page-body-wrapper ends -->
    </div>

    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="/assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="/assets/vendors/chart.js/Chart.min.js"></script>
    <script src="/assets/vendors/progressbar.js/progressbar.min.js"></script>
    <script src="/assets/vendors/jvectormap/jquery-jvectormap.min.js"></script>
    <script src="/assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="/assets/vendors/owl-carousel-2/owl.carousel.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="/assets/js/off-canvas.js"></script>
    <script src="/assets/js/hoverable-collapse.js"></script>
    <script src="/assets/js/misc.js"></script>
    <script src="/assets/js/settings.js"></script>
    <script src="/assets/js/todolist.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="/assets/js/dashboard.js"></script>
    <!-- End custom js for this page -->
</body>

</html>